<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/html-canvas-image/html-canvas-image.html">

<dom-module id="meme-generator">
  <template>
    <style>
      :host {
        display: block;
      }

      span {
        @apply(--paper-font-body1);
      }

      paper-fab {
        position: fixed;
        bottom: 24px;
        z-index: 9999;
        transition: box-shadow 0.28s cubic-bezier(0.4, 0, 0.2, 1);;
      }

      paper-fab.download {
        left: 50%;
        background: #03a9f4;
      }

      paper-card {
        max-width: 350px;
        max-height: 350px;
        --paper-card-header-color: var(--primary-background-color);
        font-family: Impact, Charcoal, sans-serif;
        font-weight: 900;
        text-transform: uppercase;
        text-align: center;
        -webkit-text-stroke: 1px black;
        text-shadow:
                2px 2px 0 #000,
                  /* Simulated effect for Firefox and Opera
                     and nice enhancement for WebKit */
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px  1px 0 #000,
                1px  1px 0 #000;
        /* If you want your things to swipe nicely, you might want to disable
         * text selection on those elements. */
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        cursor: default;
      }
      .heading {
        color: #ffffff;
        position: absolute;
        top: 16px;
        left: 16px;
        font-size: 24px;
      }
      #pageLeft {
        left: 24px;
      }
      #pageRight {
        right: 24px;
      }
      p {
        font-size: 44px;
        position: absolute;
        top: 65px;
        color: white;
      }
      .hiding {
        display: none;
      }
      .flex-horizontal {
        @apply(--layout-horizontal);
      }
      .flexchild {
        @apply(--layout-flex);
      }
    </style>

        <div class="container flex-horizontal">
          <div class="flexchild"></div>
          <iron-ajax auto url="./memes.json" handle-as="json" last-response="{{memesDataResponse}}"></iron-ajax>
          <iron-pages id="memePages" selected="0">
            <template is="dom-repeat" items="[[memesDataResponse.items]]">
              <iron-swipeable-container swipe-style="curve">
                <paper-card heading="{{footer}}" image="../../images/memes/[[item.imageUrl]]" contentEditable="true">
                  <div class="heading">
                    {{greeting}}
                  </div>
                </paper-card>

              </iron-swipeable-container>
            </template>

          </iron-pages>


          <div class="flexchild"></div>
        </div>


    <div class="container flex-horizontal">
      <div class="flexchild"></div>
      <paper-dropdown-menu label="Choose your meme">
        <paper-listbox class="dropdown-content">
          <paper-item>chemistry-cat</paper-item>
          <paper-item>interesting-man</paper-item>
          <paper-item>cat-news</paper-item>
          <paper-item>yo-dawg</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>
      <div class="flexchild"></div>
    </div>

    <paper-input-container>
      <paper-icon-button prefix icon="create"></paper-icon-button>
      <label>Top Line</label>
      <input is="iron-input" value="{{greeting::input}}">
      <paper-icon-button suffix icon="close" on-tap="clearInput" data-property-to-clear="greeting"></paper-icon-button>
    </paper-input-container>

    <paper-input-container>
      <paper-icon-button prefix icon="create"></paper-icon-button>
      <label>Bottom Line</label>
      <input is="iron-input" value="{{footer::input}}">
      <paper-icon-button suffix icon="close" on-tap="clearInput" data-property-to-clear="footer"></paper-icon-button>
    </paper-input-container>

    <html-canvas-image id="memeImageGenerator" container="memePages" filename="meme.png"></html-canvas-image>
    <paper-fab icon="file-download" title="Download" on-tap="saveImage" id="pageRight"></paper-fab>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'meme-generator',

        properties: {
          items: {
            type: Array,
            notify: true
          },
          greeting: {
            type: String,
            value: '',
            notify: true
          },
          footer: {
            type: String,
            value: '',
            notify: true
          }
        },
        listeners: {
          'iron-swipe': 'nextPage'
        },

        /**
         * Generate image
         */
        saveImage: function() {
          this.$.memeImageGenerator.generateImage();
        },

        /**
         * Clear a specified input
         */
        clearInput: function(e) {
          var propertyToClear = e.target.parentElement.getAttribute('data-property-to-clear');
          this[propertyToClear] = '';
        },

        ready: function() {
          this.items = [
            'heading',
            'footer',
            'filepath'
          ];
        },
        nextPage: function() {
          this.$.memePages.selectNext();
        },
        previousPage: function() {
          this.$.memePages.selectPrevious();
        }
      });
    })();
  </script>
</dom-module>
